<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        body { font-family: -apple-system, sans-serif; background: #f4f7f6; padding: 20px; }
        .container { max-width: 400px; margin: auto; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: #007bff; }
        input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 18px; text-align: center; }
        .btn-search { width: 100%; padding: 12px; background: #007bff; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .result-card { display: none; margin-top: 20px; padding: 15px; border-radius: 10px; background: #f8f9fa; border-left: 5px solid #007bff; }
        .status-badge { display: inline-block; padding: 3px 10px; border-radius: 10px; background: #ffc107; font-size: 14px; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <h2>üîç ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</h2>
    <input type="text" id="ticketId" placeholder="‡πÉ‡∏™‡πà‡πÄ‡∏•‡∏Ç‡∏á‡∏≤‡∏ô ‡πÄ‡∏ä‡πà‡∏ô SUP#001">
    <button class="btn-search" onclick="trackJob()">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</button>

    <div id="result" class="result-card">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <b id="resId"></b>
            <span id="resStatus" class="status-badge"></span>
        </div>
        <p style="margin: 10px 0; font-size: 14px;">
            <b>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà:</b> <span id="resCat"></span><br>
            <b>‡∏õ‡∏±‡∏ç‡∏´‡∏≤:</b> <span id="resIssue"></span><br>
            <b>‡∏ä‡πà‡∏≤‡∏á‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•:</b> <span id="resAdmin"></span>
        </p>
    </div>
</div>

<script>
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbz86RG6_VraHFO3v0_M_DoAAnvAFOHRWkEZfkGavxxMmK4F5497aydEN3R92YeY1w27/exec";
    const LIFF_ID = "2008875334-wOYUvNha";
    let myUid = "";

    async function init() {
        await liff.init({ liffId: LIFF_ID });
        if (!liff.isLoggedIn()) {
            liff.login();
        } else {
            const profile = await liff.getProfile();
            myUid = profile.userId;
        }
    }

    async function trackJob() {
        const tid = document.getElementById('ticketId').value.trim().toUpperCase();
        if (!tid) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏á‡∏≤‡∏ô");

        const resDiv = document.getElementById('result');
        resDiv.style.display = 'none';

        try {
            const response = await fetch(`${WEB_APP_URL}?action=track&tid=${tid}&uid=${myUid}`);
            const data = await response.json();

            if (data.found) {
                document.getElementById('resId').innerText = data.ticketId;
                document.getElementById('resStatus').innerText = data.status;
                document.getElementById('resCat').innerText = data.category;
                document.getElementById('resIssue').innerText = data.issue;
                document.getElementById('resAdmin').innerText = data.admin;
                resDiv.style.display = 'block';
            } else {
                alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏•‡∏Ç‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ ‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ");
            }
        } catch (err) {
            alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà");
            console.error(err);
        }
    }

    init();
</script>
</body>
</html>
