<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #000080; --accent: #FBCEB1; --bg: #f8f9fa; }
        * { box-sizing: border-box; font-family: 'Prompt', sans-serif; }
        body { background-color: var(--bg); margin: 0; padding: 20px; color: #333; }
        .container { max-width: 500px; margin: auto; }
        
        .header { text-align: center; margin-bottom: 25px; }
        .header h2 { color: var(--primary); margin: 10px 0; }

        .search-box {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }
        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; font-size: 14px; margin-bottom: 5px; color: #666; }
        input { 
            width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px; 
            font-size: 16px; outline: none; transition: 0.3s;
        }
        input:focus { border-color: var(--primary); }

        .btn-search {
            width: 100%; padding: 12px; background: var(--primary); color: white;
            border: none; border-radius: 10px; font-size: 16px; font-weight: 600; cursor: pointer;
        }

        /* Result Card */
        #result { display: none; margin-top: 20px; }
        .status-card {
            background: white; padding: 20px; border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08); border-top: 8px solid var(--primary);
        }
        .status-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .ticket-id { font-size: 20px; font-weight: 800; color: var(--primary); }
        
        /* Status Badge Colors */
        .badge { padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; }
        .bg-pending { background: #fff3cd; color: #856404; }
        .bg-process { background: #cfe2ff; color: #084298; }
        .bg-external { background: #e2e3e5; color: #41464b; }
        .bg-success { background: #d1e7dd; color: #0f5132; }

        .info-row { display: flex; margin-bottom: 10px; font-size: 14px; border-bottom: 1px solid #f0f0f0; padding-bottom: 8px; }
        .info-label { width: 100px; color: #888; flex-shrink: 0; }
        .info-value { color: #333; font-weight: 500; }

        .loader { display: none; text-align: center; margin-top: 20px; }
        .spinner { 
            border: 4px solid #f3f3f3; border-top: 4px solid var(--primary); 
            border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: auto;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h2>‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°</h2>
        <p style="font-size: 13px; color: #888;">‡∏Å‡∏£‡∏≠‡∏Å‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç Ticket ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤</p>
    </div>

    <div class="search-box">
        <div class="input-group">
            <label for="ticketInput">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç Ticket (‡πÄ‡∏ä‡πà‡∏ô IT#001)</label>
            <input type="text" id="ticketInput" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì" autocomplete="off">
        </div>
        <button class="btn-search" onclick="searchTicket()">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</button>
    </div>

    <div id="loader" class="loader">
        <div class="spinner"></div>
        <p style="font-size: 13px; color: #666; margin-top: 10px;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
    </div>

    <div id="result">
        <div class="status-card">
            <div class="status-header">
                <span class="ticket-id" id="resTicket"></span>
                <span id="resBadge" class="badge"></span>
            </div>
            
            <div class="info-row">
                <div class="info-label">üìç ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà:</div>
                <div class="info-value" id="resRoom"></div>
            </div>
            <div class="info-row">
                <div class="info-label">üîß ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£:</div>
                <div class="info-value" id="resIssue"></div>
            </div>
            <div class="info-row">
                <div class="info-label">‚ö†Ô∏è ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:</div>
                <div class="info-value" id="resPrio"></div>
            </div>
            <div class="info-row">
                <div class="info-label">üë§ ‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà:</div>
                <div class="info-value" id="resAdmin" style="color: var(--primary); font-weight: 600;"></div>
            </div>
            <div class="info-row" style="border: none;">
                <div class="info-label">üïí ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠:</div>
                <div class="info-value" id="resTime"></div>
            </div>
        </div>
    </div>
</div>

<script>
    // ** ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö URL_GAS ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Admin ‡πÅ‡∏•‡∏∞ Index **
    const URL_GAS = "https://script.google.com/macros/s/AKfycby7gaRKVcrfqxhHQTchgOn4tgqno6UJjXZPv23A-d7xE6CgSUDWfmF_T3-xvitCzDxW/exec";
    const LIFF_ID = "2008875334-wOYUvNha"; // ‡πÉ‡∏™‡πà LIFF ID ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
    let userUid = "";

    async function initLiff() {
        try {
            await liff.init({ liffId: LIFF_ID });
            if (!liff.isLoggedIn()) {
                liff.login();
            } else {
                const profile = await liff.getProfile();
                userUid = profile.userId;
            }
        } catch (err) {
            console.error("LIFF Init Error", err);
        }
    }

    async function searchTicket() {
        const ticketId = document.getElementById('ticketInput').value.trim();
        if (!ticketId) {
            alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç Ticket");
            return;
        }

        const loader = document.getElementById('loader');
        const resultDiv = document.getElementById('result');
        
        loader.style.display = 'block';
        resultDiv.style.display = 'none';

        try {
            // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏î‡∏¢‡∏™‡πà‡∏á Ticket ID ‡πÅ‡∏•‡∏∞ UID (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á)
            const response = await fetch(`${URL_GAS}?action=track&tid=${encodeURIComponent(ticketId)}&uid=${userUid}`);
            const data = await response.json();

            if (data.found) {
                document.getElementById('resTicket').innerText = data.ticketId || ticketId;
                document.getElementById('resRoom').innerText = data.room;
                document.getElementById('resIssue').innerText = data.issue;
                document.getElementById('resPrio').innerText = data.priority;
                document.getElementById('resTime').innerText = data.time;
                
                // ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏∑‡πà‡∏≠ Admin (‡∏ó‡∏µ‡πà Code.gs ‡πÅ‡∏õ‡∏•‡∏á‡∏à‡∏≤‡∏Å UID ‡∏°‡∏≤‡πÉ‡∏´‡πâ‡πÅ‡∏•‡πâ‡∏ß)
                document.getElementById('resAdmin').innerText = data.admin;

                // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Badge ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
                const badge = document.getElementById('resBadge');
                badge.innerText = data.status;
                badge.className = 'badge'; // reset
                
                if (data.status === "‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£") badge.classList.add('bg-pending');
                else if (data.status === "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£") badge.classList.add('bg-process');
                else if (data.status === "‡∏à‡∏±‡∏î‡∏à‡πâ‡∏≤‡∏á‡∏£‡πâ‡∏≤‡∏ô‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å") badge.classList.add('bg-external');
                else if (data.status === "‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß") badge.classList.add('bg-success');

                resultDiv.style.display = 'block';
            } else {
                alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç Ticket ‡∏ô‡∏µ‡πâ ‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ");
            }
        } catch (err) {
            console.error(err);
            alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•");
        } finally {
            loader.style.display = 'none';
        }
    }

    initLiff();
</script>
</body>
</html>
