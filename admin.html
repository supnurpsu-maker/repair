<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        :root { --primary: #000080; --accent: #FBCEB1; }
        body { font-family: sans-serif; background: #f0f2f5; margin: 0; padding: 15px; }
        .header { background: var(--primary); color: white; padding: 15px; border-radius: 10px; text-align: center; }
        .card { background: white; border-radius: 10px; padding: 15px; margin-top: 15px; border-left: 6px solid #ccc; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .p-‡∏î‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î { border-left-color: #d9534f; }
        .p-‡∏î‡πà‡∏ß‡∏ô { border-left-color: #f0ad4e; }
        .p-‡∏õ‡∏Å‡∏ï‡∏¥ { border-left-color: #5cb85c; }
        .btn-row { display: flex; gap: 5px; margin-top: 10px; flex-wrap: wrap; }
        button { border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 12px; }
        .b-blue { background: var(--primary); color: white; }
        .b-green { background: #28a745; color: white; }
        .b-grey { background: #6c757d; color: white; }
    </style>
</head>
<body>
    <div class="header"><h3>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô IT</h3><p id="adminInfo"></p></div>
    <div id="jobList"></div>
<script>
    const URL_GAS = "https://script.google.com/macros/s/AKfycbwx34DQPx307XyZUJiLoKYlyZn5pHt3QKfPJZ39GF6m0inAxx6MU1YU4xwRlJROb7U3/exec"; const LIFF_ID = "2008875334-VPUmuC8D";
    let myUid = "";
    async function init() {
        await liff.init({ liffId: LIFF_ID });
        if (!liff.isLoggedIn()) liff.login();
        const p = await liff.getProfile(); myUid = p.userId;
        const res = await fetch(`${URL_GAS}?action=checkAdmin&uid=${myUid}`);
        const auth = await res.json();
        if (auth.isAdmin) {
            document.getElementById("adminInfo").innerText = auth.name;
            load();
        } else alert("‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå Admin");
    }
    async function load() {
        const res = await fetch(`${URL_GAS}?action=listPending&uid=${myUid}`);
        const jobs = await res.json();
        const div = document.getElementById("jobList");
        div.innerHTML = "";
        jobs.forEach(j => {
            div.innerHTML += `
                <div class="card p-${j.priority}">
                    <b>${j.ticketId}</b> [${j.status}]<br>
                    üìç ${j.room} | üë§ ${j.name}<br>
                    ‚ö†Ô∏è ${j.issue}<br>
                    <div class="btn-row">
                        <button class="b-blue" onclick="up(${j.row}, '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£')">‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô</button>
                        <button class="b-green" onclick="up(${j.row}, '‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß')">‡∏õ‡∏¥‡∏î‡∏á‡∏≤‡∏ô</button>
                        <button class="b-grey" onclick="up(${j.row}, '‡∏£‡∏≠‡∏£‡πâ‡∏≤‡∏ô‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£')">‡∏£‡∏≠‡∏£‡πâ‡∏≤‡∏ô‡∏ô‡∏≠‡∏Å</button>
                        <button class="b-grey" onclick="up(${j.row}, '‡∏£‡∏≠‡∏à‡∏±‡∏î‡∏à‡πâ‡∏≤‡∏á‡∏£‡πâ‡∏≤‡∏ô‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å')">‡∏£‡∏≠‡∏à‡∏±‡∏î‡∏à‡πâ‡∏≤‡∏á</button>
                    </div>
                </div>`;
        });
    }
    async function up(r, s) { if(confirm("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô?")) { await fetch(`${URL_GAS}?action=updateStatus&row=${r}&status=${s}&uid=${myUid}`); load(); } }
    init();
</script>
</body>
</html>
