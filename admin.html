<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        :root { --primary: #000080; --accent: #FBCEB1; }
        body { font-family: sans-serif; background: #f0f2f5; margin: 0; padding: 15px; }
        .header { background: var(--primary); color: white; padding: 20px; border-radius: 12px; text-align: center; margin-bottom: 20px; }
        .card { background: white; border-radius: 10px; padding: 18px; margin-bottom: 15px; border-left: 6px solid #ccc; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .p-‡∏î‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î { border-left-color: #d9534f; background: #fff5f5; }
        .p-‡∏î‡πà‡∏ß‡∏ô { border-left-color: #f0ad4e; }
        .p-‡∏õ‡∏Å‡∏ï‡∏¥ { border-left-color: #5cb85c; }
        .ticket-id { color: var(--primary); font-weight: bold; font-size: 1.1em; }
        .badge { font-size: 12px; background: var(--accent); color: var(--primary); padding: 2px 10px; border-radius: 20px; font-weight: bold; }
        .info { font-size: 14px; margin: 10px 0; color: #444; line-height: 1.5; }
        .btn-row { display: flex; gap: 8px; margin-top: 12px; }
        .btn-sub { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; margin-top: 8px; }
        button { border: none; padding: 10px; border-radius: 5px; cursor: pointer; font-weight: bold; font-size: 13px; }
        .b-blue { background: var(--primary); color: white; flex: 1; }
        .b-green { background: #28a745; color: white; flex: 1; }
        .b-grey { background: #6c757d; color: white; }
    </style>
</head>
<body>
    <div class="header">
        <h3 style="margin:0">‡πÅ‡∏ú‡∏á‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà IT</h3>
        <p id="adminInfo" style="margin:5px 0 0; font-size:12px; opacity:0.8;"></p>
    </div>
    <div id="jobList"></div>
<script>
    const URL = "https://script.google.com/macros/s/AKfycbw0gKLCAq2p2LZ39KQRazud5OZZSshDhfh-GoGr7i4oC3rw3DFC8v_geMrbrcSEVGQr/exec"; const LIFF_ID = "2008875334-VPUmuC8D";
    let myUid = "";
    async function init() {
        await liff.init({ liffId: LIFF_ID });
        if (!liff.isLoggedIn()) liff.login();
        const p = await liff.getProfile(); myUid = p.userId;
        const res = await fetch(`${URL}?action=checkAdmin&uid=${myUid}`);
        const auth = await res.json();
        if (auth.isAdmin) {
            document.getElementById("adminInfo").innerText = `‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà: ${auth.name} | ‡πÅ‡∏ú‡∏ô‡∏Å: ${auth.dept}`;
            load();
        } else document.body.innerHTML = "‚ùå ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á";
    }
    async function load() {
        const res = await fetch(`${URL}?action=listPending&uid=${myUid}`);
        const jobs = await res.json();
        const div = document.getElementById("jobList");
        div.innerHTML = jobs.length === 0 ? "<center>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏á‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏á</center>" : "";
        jobs.forEach(j => {
            div.innerHTML += `
                <div class="card p-${j.priority}">
                    <div style="display:flex; justify-content:space-between">
                        <span class="ticket-id">${j.ticketId}</span>
                        <span class="badge">${j.status}</span>
                    </div>
                    <div class="info">
                        üìç <b>‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà:</b> ${j.room} | üë§ <b>‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á:</b> ${j.name}<br>
                        ‚ö†Ô∏è <b>‡∏õ‡∏±‡∏ç‡∏´‡∏≤:</b> ${j.issue}<br>
                        üõ† <b>‡∏ä‡πà‡∏≤‡∏á:</b> ${j.adminName || '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏ô‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô'}
                    </div>
                    <div class="btn-row">
                        <button class="b-blue" onclick="up(${j.row}, '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£')">‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô</button>
                        <button class="b-green" onclick="up(${j.row}, '‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß')">‡∏õ‡∏¥‡∏î‡∏á‡∏≤‡∏ô</button>
                    </div>
                    <div class="btn-sub">
                        <button class="b-grey" onclick="up(${j.row}, '‡∏£‡∏≠‡∏£‡πâ‡∏≤‡∏ô‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£')">‡∏£‡∏≠‡∏£‡πâ‡∏≤‡∏ô‡∏ô‡∏≠‡∏Å</button>
                        <button class="b-grey" onclick="up(${j.row}, '‡∏£‡∏≠‡∏à‡∏±‡∏î‡∏à‡πâ‡∏≤‡∏á‡∏£‡πâ‡∏≤‡∏ô‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å')">‡∏£‡∏≠‡∏à‡∏±‡∏î‡∏à‡πâ‡∏≤‡∏á</button>
                    </div>
                </div>`;
        });
    }
    async function up(r, s) { if(confirm(`‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô ${s}?`)) { await fetch(`${URL}?action=updateStatus&row=${r}&status=${s}&uid=${myUid}`); load(); } }
    init();
</script>
</body>
</html>
